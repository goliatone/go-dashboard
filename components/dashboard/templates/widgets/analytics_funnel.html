<div class="widget widget--analytics widget--funnel">
  <header>
    <h3>{{ T("dashboard.widget.analytics_funnel.title", locale, "Conversion Funnel") }}</h3>
    <small>{{ widget.data.range or "30d" }} Â· {{ widget.data.segment or T("dashboard.widget.analytics_funnel.segment_all", locale, "All users") }}</small>
  </header>
  <div class="widget__meta">
    <span>{{ (widget.data.conversion_rate or 0)|floatformat:1 }}% {{ T("dashboard.widget.analytics_funnel.conversion_label", locale, "conversion") }}</span>
    <span>{{ T("dashboard.widget.analytics_funnel.goal_label", locale, "Goal") }} {{ (widget.data.goal or widget.config.goal or 0)|floatformat:1 }}%</span>
  </div>
  <ol class="funnel-steps">
    {% for step in widget.data.steps %}
    <li class="funnel-steps__item">
      <div class="funnel-steps__bar">
        <span style="width: {{ step.percent }}%;"></span>
      </div>
      <div class="funnel-steps__label">
        <strong>{{ step.label }}</strong>
        <span>{{ step.value }} {{ T("dashboard.widget.analytics_funnel.records_label", locale, "records") }}</span>
        {% if step.position > 0 %}
        <small>{{ step.dropoff or 0 }}% {{ T("dashboard.widget.analytics_funnel.drop_label", locale, "drop") }}</small>
        {% endif %}
      </div>
    </li>
    {% endfor %}
  </ol>
</div>
